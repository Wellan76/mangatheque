<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mangathèque</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header>
    <h1>Ma Mangathèque</h1>
    <button id="logoutBtn">Se déconnecter</button>
  </header>

  <main id="series-list">
    <!-- Exemple de série -->
    <div class="serie">
      <a href="series/black butler.html">
        <img src="https://static.fnac-static.com/multimedia/PE/Images/FR/NR/e3/48/29/2705635/1507-1/tsp20250809084652/Black-Butler-Tome-1.jpg" alt="black butler">
        <h3>Black butler</h3>
      </a>
      <label>
        <input type="checkbox" class="complete-checkbox" data-id="black butler"> Série complète
      </label>
    </div>

    <div class="serie">
      <a href="series/solo-leveling.html">
        <img src="https://upload.wikimedia.org/wikipedia/en/0/0f/Solo_Leveling_Volume_1.jpg" alt="Solo Leveling">
        <h3>Solo Leveling</h3>
      </a>
      <label>
        <input type="checkbox" class="complete-checkbox" data-id="solo-leveling"> Série complète
      </label>
    </div>
  </main>

  <script type="module">
    import { auth, db } from "./js/firebase-init.js";
    import { onAuthStateChanged, signOut } 
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { doc, setDoc, getDoc } 
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const logoutBtn = document.getElementById('logoutBtn');
    const checkboxes = document.querySelectorAll('.complete-checkbox');

    onAuthStateChanged(auth, user => {
      if (!user) {
        window.location.href = "login.html";
      } else {
        // Charger état des cases
        checkboxes.forEach(async checkbox => {
          const docRef = doc(db, "users", user.uid, "series", checkbox.dataset.id);
          const docSnap = await getDoc(docRef);
          if (docSnap.exists() && docSnap.data().complete) {
            checkbox.checked = true;
          }
          checkbox.addEventListener('change', async () => {
            await setDoc(docRef, { complete: checkbox.checked });
          });
        });
      }
    });

    logoutBtn.addEventListener('click', () => {
      signOut(auth);
    });
  </script>
</body>
</html>

<script type="module" src="js/firebase-init.js"></script>
